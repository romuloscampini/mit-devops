<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.7.1">
<title>Smart contracts and Solidity</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote::before{display:none}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{word-spacing:0;line-height:1.6}
.quoteblock.abstract blockquote::before,.quoteblock.abstract p::before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
</div>
<div id="content">
<div class="sect1">
<h2 id="smart_contracts_chapter">Smart contracts and Solidity</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As we discussed in <a href="#intro_chapter">[intro_chapter]</a>, there are two different types of account in Ethereum: Externally Owned Accounts (EOAs) and contract accounts. EOAs are controlled by users, often via software, such as a wallet application, that are external to the Ethereum platform. In contrast to that, contract accounts are controlled by their program code (also commonly referred to as smart contracts) that is executed by the Ethereum Virtual Machine (EVM). In short, EOA are simple accounts without any associated code or data storage, whereas contract accounts have both associated code and data storage. EOAs are controlled by transactions created and cryptographically signed with a private key in the "real world" external to and independent of the protocol, whereas contract accounts do not have private keys and so "control themselves" in the predetermined way prescribed by their smart contract code. Both types of accounts are identified by an Ethereum address. In this section, we will discuss contract accounts, and the program code that controls them: smart contracts.</p>
</div>
<div class="sect2">
<h3 id="smart_contracts_definition">What is a smart contract?</h3>
<div class="paragraph">
<p>The term <em>smart contract</em> has been used over the years to describe a wide variety of different things. In the 1990s, cryptographer Nick Szabo coined the term and defined it as “a set of promises, specified in digital form, including protocols within which the parties perform on the other promises”. Since then, the concept of smart contracts has evolved, especially after the introduction of decentralized blockchain platforms with the invention of Bitcoin in 2009. In the context of Ethereum, the term is actually a bit of a misnomer, given that Ethereum smart contracts are neither smart nor legal contracts, but the term has stuck. In this book, we use the term “smart contract” to refer to immutable computer programs that run deterministically in the context of an Ethereum Virtual Machine as part of the Ethereum network protocol, i.e. on the decentralized Ethereum world computer.</p>
</div>
<div class="paragraph">
<p>Let’s unpack that definition:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Computer programs: Smart contracts are simply computer programs. The word contract has no legal meaning in this context.</p>
</li>
<li>
<p>Immutable: Once deployed, the code of a smart contract cannot change. Unlike traditional software, the only way to modify a smart contract is to deploy a new instance.</p>
</li>
<li>
<p>Deterministic:  The outcome of the execution of a smart contract is the same for everyone who runs it, given the context of the transaction that initiated its execution and the state of the Ethereum blockchain at the moment of execution.</p>
</li>
<li>
<p>The EVM context: Smart contracts operate with a very limited execution context. They can access their own state, the context of the transaction that called them and some information about the most recent blocks.</p>
</li>
<li>
<p>Decentralized world computer: The EVM runs as a local instance on every Ethereum node, but because all instances of the EVM operate on the same initial state and produce the same final state, the system as a whole operates as a single "world computer".</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="smart_contract_lifecycle">Lifecycle of a smart contract</h3>
<div class="paragraph">
<p>Smart contracts are typically written in a high-level language, such as Solidity. But in order to run, they must be compiled to the low-level bytecode that runs in the EVM. Once compiled, they are deployed on the Ethereum platform using a special <em>contract creation</em> transaction which is identified as such by being sent to the special contract creation address, namely 0x0. Each contract is identified by an Ethereum address, which is derived from the contract creation transaction as a function of the originating account and nonce. The Ethereum address of a contract can be used in a transaction as the recipient, sending funds to the contract or calling one of the contract’s functions. Note that, unlike EOAs, there are no keys associated with an account created for a new smart contract. As the contract creator, you don&#8217;t get any special privileges at the protocol level (although you can explicitly code them into the smart contract, of course). You certainly don&#8217;t receive the private key for the contract account - it doesn&#8217;t exist - we can say that smart contract accounts own themselves.</p>
</div>
<div class="paragraph">
<p>Importantly, contracts <em>only run if they are called by a transaction</em>. All smart contracts in Ethereum are executed, ultimately, because of a transaction initiated from an Externally Owned Account. A contract can call another contract that can call another contract, and so on, but the first contract in such a chain of execution will always have been called by a transaction from an EOA. Contracts never run “on their own”, or “run in the background”. Contracts effectively lie dormant until a transaction triggers execution, either directly or indirectly as part of a chain of contract calls. It is also worth noting that smart contracts are not executed "in parallel" in any sense - the Ethereum world computer can be considered to be a single-threaded machine.</p>
</div>
<div class="paragraph">
<p>Transactions are <em>atomic</em>, regardless of how many contracts they call or what those contracts do when called. Transactions execute in their entirety, with any changes in the global state (contracts, accounts, etc.) recorded only if all execution terminates successfully. Successful termination means that the program executed without an error and reached the end of execution. If execution fails due to an error, all of its effects (changes in state) are “rolled back” as if the transaction never ran. A failed transaction is still recorded as having been attempted, and the ether spent on gas for the execution is deducted from the originating account, but it otherwise has no other effects on contract or account state.</p>
</div>
<div class="paragraph">
<p>As mentioned above, it is important to remember that a contract’s code cannot be changed. However a contract can be “deleted”, removing the code and its internal state (storage) from its address, leaving a blank account. Any transactions sent to that account address after the contract has been deleted do not result in any code execution, because there is no longer any code there to execute. To delete a contract, you execute an EVM opcode called SELFDESTRUCT (previously called SUICIDE). That operation costs “negative gas”, a gas refund, thereby incentivizing the release of network client resources from the deletion of stored state. Deleting a contract in this way does not remove the transaction history (past) of the contract, since the blockchain itself is immutable. It is also important to note that the SELFDESTRUCT capability will only be available if the contract author programmed the smart contract to have that functionality. If the contract&#8217;s code does not have a SELFDESTRUCT opcode, or it is inaccessible, the smart contract can not be deleted.</p>
</div>
</div>
<div class="sect2">
<h3 id="high_level_languages">Introduction to Ethereum high-level languages</h3>
<div class="paragraph">
<p>The EVM is an virtual machine that runs a special form of <em>machine code</em> called <em>EVM bytecode</em>, just like your computer&#8217;s CPU, which runs machine code such as x86_64. We will examine the operation and language of the EVM in much more detail in <a href="#evm_chapter">[evm_chapter]</a>. In this section we will look at how smart contracts are written to run on the EVM.</p>
</div>
<div class="paragraph">
<p>While it is possible to program smart contracts directly in bytecode, EVM bytecode is rather unwieldy and very difficult for programmers to read and understand. Instead, most Ethereum developers use a high-level language to write programs, and a compiler to convert them into bytecode.</p>
</div>
<div class="paragraph">
<p>While any high-level language could be adapted to write smart contracts, adapting an arbitrary language to be compilable to EVM bytecode is quite a cumbersome exercise and would in general lead to some amount of confusion. Smart contracts operate in a highly constrained and minimalistic execution environment (the EVM). In addition, a special set of EVM-specific system variables and functions need to be available. As such, it is easier to build a smart contract language from scratch than it is to make a general-purpose language suitable for writing smart contracts. As a result, a number of special-purpose languages have emerged for programming smart contracts. Ethereum has several such languages, together with the compilers needed to produce EVM-executable bytecode.</p>
</div>
<div class="paragraph">
<p>In general, programming languages can be classified into two broad programming paradigms: declarative and imperative, also known as “functional” and “procedural”, respectively. In declarative programming, we write functions that express the <em>logic</em> of a program, but not its <em>flow</em>. Declarative programming is used to create programs where there are no <em>side effects</em>, meaning that there are no changes to state outside of a function. Declarative programming languages include Haskell and SQL. Imperative programming, by contrast, is where a programmer writes a set of procedures that combine the logic and flow of a program. Imperative programming languages include C++ and Java. Some languages are “hybrid”, meaning that they encourage declarative programming but can also be used to express an imperative programming paradigm. Such hybrids include Lisp, JavaScript, and Python. In general, any imperative language can be used to write in a declarative paradigm, but it often results in inelegant code. By comparison, pure declarative languages cannot be used to write in an imperative paradigm. In purely declarative languages, <em>there are no “variables”</em>.</p>
</div>
<div class="paragraph">
<p>While imperative programming is more commonly used by programmers, it can be very difficult to write programs that execute <em>exactly as expected</em>. The ability of any part of the program to change the state of any other makes it difficult to reason about a program’s execution and introduces many opportunities for bugs. Declarative programming by comparison makes it easier to understand how a program will behave: since it has no side effects, any part of a program can be understood in isolation.</p>
</div>
<div class="paragraph">
<p>In smart contracts, bugs literally cost money. As a result, it is critically important to write smart contracts without unintended effects. To do that, you must be able to clearly reason about the expected behavior of the program. So, declarative languages play a much bigger role in smart contracts than they do in general-purpose software. Nevertheless, as you will see below, the most widely-used language for smart contracts (Solidity) is imperative. Programmers, like most humans, resist change!</p>
</div>
<div class="paragraph">
<p>Currently supported high-level programming languages for smart contracts include (ordered by approximate age):</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">LLL</dt>
<dd>
<p>A functional (declarative) programming language, with Lisp-like syntax. It was the first high-level language for Ethereum smart contracts but is rarely used today.</p>
</dd>
<dt class="hdlist1">Serpent</dt>
<dd>
<p>A procedural (imperative) programming language with a syntax similar to Python. Can also be used to write functional (declarative) code, though it is not entirely free of side effects.</p>
</dd>
<dt class="hdlist1">Solidity</dt>
<dd>
<p>A procedural (imperative) programming language with a syntax similar to JavaScript, C++ or Java. The most popular and frequently used language for Ethereum smart contracts.</p>
</dd>
<dt class="hdlist1">Vyper</dt>
<dd>
<p>A more recently developed language, similar to Serpent and again with Python-like syntax. Intended to get closer to a pure-functional Python-like language than Serpent, but not to replace Serpent.</p>
</dd>
<dt class="hdlist1">Bamboo</dt>
<dd>
<p>A newly developed language, influenced by Erlang, with explicit state transitions and without iterative flows (loops). Intended to reduce side effects and increase auditability. Very new and yet to be widely adopted.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>As you can see, there are many languages to choose from. However, of all these Solidity is by far the most popular, to the point of being the <em>de facto</em> high-level language of Ethereum and even other EVM-like blockchains. We will spend most of our time using Solidity, but will also explore some of the examples in other high-level languages, to gain an understanding of their different philosophies.</p>
</div>
</div>
<div class="sect2">
<h3 id="building_a_smart_contract_sec">Building a smart contract with Solidity</h3>
<div class="paragraph">
<p>Solidity was created by Gavin Wood (co-author of this book) as a language explicitly for writing smart contracts with features to directly support execution in the decentralized environment of the Ethereum world computer. The resulting attributes are quite general and so it has ended up being used for coding smart contracts on several other blockchain platforms. It was developed by Christian Reitiwessner and then also by Alex Beregszaszi, Liana Husikyan, Yoichi Hirai and several former Ethereum core contributors. Solidity is now developed and maintained as an independent project on GitHub:</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/ethereum/solidity" class="bare">https://github.com/ethereum/solidity</a></p>
</div>
<div class="paragraph">
<p>The main "product" of the Solidity project is the <em>Solidity Compiler (solc)</em>, which converts programs written in the Solidity language to EVM bytecode. The project also manages the important Application Binary Interface (ABI) standard for Ethereum smart contracts, which we will explore in detail in this chapter. Each version of the Solidity compiler corresponds to and compiles a specific version of the Solidity language.</p>
</div>
<div class="paragraph">
<p>To get started, we will download a binary executable of the Solidity compiler. Then we will develop and compile a simple contract, following on from the example we started with in <a href="#intro_chapter">[intro_chapter]</a>.</p>
</div>
<div class="sect3">
<h4 id="_selecting_a_version_of_solidity">Selecting a version of Solidity</h4>
<div class="paragraph">
<p>Solidity follows a versioning model called <em>semantic versioning</em> (<a href="https://semver.org/" class="bare">https://semver.org/</a>), which specifies version numbers structured as three numbers separated by dots: MAJOR.MINOR.PATCH. The "major" number is incremented for major and <em>backwards incompatible</em> changes, the "minor" number is incremented as backwards compatible features are added in between major releases, and the "patch" number is incremented for backwards compatible bug fixes.</p>
</div>
<div class="paragraph">
<p>At the time of writing, Solidity is at version 0.4.24.  The rules for major version 0, which is for initial development of a project, are different: anything may change at any time. In practice, Solidity increments treats the "minor" number as if it were the major version, and the "patch" number as if it were the minor version. Therefore, in 0.4.24, 4 is considered to be the major version, and 24 the minor version.</p>
</div>
<div class="paragraph">
<p>The 0.5 major version release of Solidity is anticipated imminently.</p>
</div>
<div class="paragraph">
<p>As we saw in <a href="#intro_chapter">[intro_chapter]</a>, your Solidity programs can contain a pragma directive that specifies the minimum and maximum version of Solidity that it is compatible with, and can be used to compile your contract.</p>
</div>
<div class="paragraph">
<p>Since Solidity is rapidly evolving it is best to always use the latest release.</p>
</div>
</div>
<div class="sect3">
<h4 id="_download_and_install">Download and Install</h4>
<div class="paragraph">
<p>There are a number of methods you can use to download and install Solidity, either as a binary release or by compiling from source code. You can find detailed instruction in the Solidity documentation at:</p>
</div>
<div class="paragraph">
<p><a href="https://solidity.readthedocs.io/en/latest/installing-solidity.html" class="bare">https://solidity.readthedocs.io/en/latest/installing-solidity.html</a></p>
</div>
<div class="paragraph">
<p>Here&#8217;s see how to install the latest binary release of Solidity on an Ubuntu/Debian operating system, using the apt package manager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ sudo add-apt-repository ppa:ethereum/ethereum
$ sudo apt update
$ sudo apt install solc</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you have solc installed, check the version by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ solc --version
solc, the solidity compiler commandline interface
Version: 0.4.24+commit.e67f0147.Linux.g++</pre>
</div>
</div>
<div class="paragraph">
<p>There are a number of other ways to install Solidity, depending on your operating system and requirements, including compiling from the source code directly. For more information see:</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/ethereum/solidity" class="bare">https://github.com/ethereum/solidity</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_development_environment">Development environment</h4>
<div class="paragraph">
<p>To develop in Solidity, you can use any text editor and solc on the command-line. However, you might find that some text editors designed for development, such as Emacs, Vim and Atom, offer additional features such as syntax highlighting and macros that make Solidity development easier.</p>
</div>
<div class="paragraph">
<p>There are also web-based development environments, such as Remix IDE (<a href="https://remix.ethereum.org/" class="bare">https://remix.ethereum.org/</a>), and EthFiddle (<a href="https://ethfiddle.com/" class="bare">https://ethfiddle.com/</a>).</p>
</div>
<div class="paragraph">
<p>Use the tools that make you productive. In the end, Solidity programs are just plain text files. While fancy editors and development environments can make things easier, you don&#8217;t need anything more than a simple text editor, such as nano (Linux/Unix), TextEdit (macOS) or even NotePad (Windows). Simply save your program source code with a .sol extension and it will be recognized by the Solidity compiler as a Solidity program.</p>
</div>
</div>
<div class="sect3">
<h4 id="_writing_a_simple_solidity_program">Writing a simple Solidity program</h4>
<div class="paragraph">
<p>In <a href="#intro_chapter">[intro_chapter]</a> we wrote our first Solidity program, <a href="#original_sol_faucet">Faucet.sol : A Solidity contract implementing a faucet</a>.  When we first built the Faucet, we used the Remix IDE to compile and deploy the contract. In this section, we will revisit, improve, and embellish Faucet.</p>
</div>
<div class="paragraph">
<p>Our first attempt looked like this:</p>
</div>
<div id="original_sol_faucet" class="listingblock">
<div class="title">Faucet.sol : A Solidity contract implementing a faucet</div>
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Our first contract is a faucet!
contract Faucet {

    // Give out ether to anyone who asks
    function withdraw(uint withdraw_amount) public {

        // Limit withdrawal amount
        require(withdraw_amount &lt;= 100000000000000000);

        // Send the amount to the address that requested it
        msg.sender.transfer(withdraw_amount);
    }

    // Accept any incoming amount
    function () public payable {}

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compiling_with_the_solidity_compiler_solc">Compiling with the Solidity compiler (solc)</h4>
<div class="paragraph">
<p>Now, we will use the Solidity compiler on the command-line to compile our contract directly. The Solidity compiler solc offers a variety of options, which you can see by passing the --help argument.</p>
</div>
<div class="paragraph">
<p>We use the --bin and --optimize arguments of solc to produce an optimized binary of our example contract <a href="#compile_Faucet_with_solc">Compiling Faucet.sol with solc</a>:</p>
</div>
<div id="compile_Faucet_with_solc" class="listingblock">
<div class="title">Compiling Faucet.sol with solc</div>
<div class="content">
<pre>$ solc --optimize --bin Faucet.sol
======= Faucet.sol:Faucet =======
Binary:
6060604052341561000f57600080fd5b60cf8061001d6000396000f300606060405260043610603e5763ffffffff7c0100000000000000000000000000000000
0000000000000000000000006000350416632e1a7d4d81146040575b005b3415604a57600080fd5b603e60043567016345785d8a0000811115606357600080fd
5b73ffffffffffffffffffffffffffffffffffffffff331681156108fc0282604051600060405180830381858888f19350505050151560a057600080fd5b5056
00a165627a7a723058203556d79355f2da19e773a9551e95f1ca7457f2b5fbbf4eacf7748ab59d2532130029</pre>
</div>
</div>
<div class="paragraph">
<p>The result that solc produces is a hex serialized binary that can be submitted to the Ethereum blockchain.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="eth_contract_abi_sec">Ethereum contract Application Binary Interface (ABI)</h3>
<div class="paragraph">
<p>In computer software, an Application Binary Interface (ABI) is an interface between two program modules; often, between the operating system and user programs. An ABI defines how data structures and functions are accessed in <strong>machine code</strong>; this is not to be confused with an API, which defines this access in high-level, often human-readable formats as <strong>source code</strong>. The ABI is thus the primary way of encoding and decoding data into and out of machine code.</p>
</div>
<div class="paragraph">
<p>In Ethereum, the ABI is used to encode contract calls for the EVM and to read data out of transactions. The purpose of an ABI is to define the functions in the contract that can be invoked and describe how each function will accept arguments and return its result.</p>
</div>
<div class="paragraph">
<p>A contract&#8217;s ABI is specified as a JSON array of function descriptions (see <a href="#solidity_functions">Functions</a>) and events (see <a href="#solidity_events">Events</a>). A function description is a JSON object with fields for <code>type</code>, <code>name</code>, <code>inputs</code>, <code>outputs</code>, <code>constant</code>, and <code>payable</code>. An event description object has fields for <code>type</code>, <code>name</code>, <code>inputs</code>, and <code>anonymous</code>.</p>
</div>
<div class="paragraph">
<p>We use the solc command-line Solidity compiler to produce the ABI for our Faucet.sol example contract:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ solc --abi Faucet.sol
======= Faucet.sol:Faucet =======
Contract JSON ABI
[{"constant":false,"inputs":[{"name":"withdraw_amount","type":"uint256"}],"name":"withdraw","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"payable":true,"stateMutability":"payable","type":"fallback"}]</pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the compiler produces a JSON array describing the two functions that are defined by Faucet.sol. This JSON can be used by any application that wants to access the Faucet contract once it is deployed. Using the ABI, an application such as a wallet or DApp browser can construct transactions that call the functions in Faucet with the correct arguments and argument types. For example, a wallet would know that to call the function withdraw it would have to provide a uint256 argument named withdraw_amount. The wallet could prompt the user to provide that value, then create a transaction that encodes it and executes the withdraw function.</p>
</div>
<div class="paragraph">
<p>All that is needed for an application to interact with a contract is an ABI and the address where the contract has been deployed.</p>
</div>
<div class="sect3">
<h4 id="solidity_pragma">Selecting Solidity compiler and language version</h4>
<div class="paragraph">
<p>As we saw in <a href="#compile_Faucet_with_solc">Compiling Faucet.sol with solc</a>, our Faucet contract compiles successfully with Solidity version 0.4.21. But what if we had used a different version of the Solidity compiler? The language is still in constant flux and things may change in unexpected ways. Our contract is fairly simple, but what if our program used a feature that was only added in Solidity version 0.4.19 and we tried to compile it with 0.4.18?</p>
</div>
<div class="paragraph">
<p>To resolve such issues, Solidity offers a <em>compiler directive</em> known as a <em>version pragma</em> that instructs the compiler that the program expects a specific compiler (and language) version. Let’s look at an example:</p>
</div>
<div id="compiler_version" class="listingblock">
<div class="content">
<pre>pragma solidity ^0.4.19;</pre>
</div>
</div>
<div class="paragraph">
<p>The Solidity compiler reads the version pragma and will produce an error if the compiler version is incompatible with the version pragma. In this case, our version pragma says that this program can be compiled by a Solidity compiler with a minimum version of 0.4.19. The symbol ^ states, however, that we allow compilation with any <em>minor revision</em> above 0.4.19, e.g. 0.4.20, but not 0.5.0 (which is a major revision, not a minor revision). Pragma directives are not compiled into EVM bytecode. They are only used by the compiler to check compatibility.</p>
</div>
<div class="paragraph">
<p>Let’s add a pragma directive to our Faucet contract. We will name the new file Faucet2.sol, to keep track of our changes as we proceed through these examples starting in <a href="#add_pragma_to_faucet">Faucet2.sol : Adding the version pragma to Faucet</a>:</p>
</div>
<div id="add_pragma_to_faucet" class="listingblock">
<div class="title">Faucet2.sol : Adding the version pragma to Faucet</div>
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Version of Solidity compiler this program was written for
pragma solidity ^0.4.19;

// Our first contract is a faucet!
contract Faucet {

    // Give out ether to anyone who asks
    function withdraw(uint withdraw_amount) public {

        // Limit withdrawal amount
        require(withdraw_amount &lt;= 100000000000000000);

        // Send the amount to the address that requested it
        msg.sender.transfer(withdraw_amount);
    }

    // Accept any incoming amount
    function () public payable {}

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Adding a version pragma is best practice, as it avoids problems with mismatched compiler and language versions. We will explore best practice and continue to improve the Faucet contract throughout this chapter.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_programming_with_solidity">Programming with Solidity</h3>
<div class="paragraph">
<p>In this section, we will look at some of the capabilities of the Solidity language. As we mentioned in <a href="#intro_chapter">[intro_chapter]</a>, our first contract example was very simple and also flawed in various ways. We&#8217;ll gradually improve it, while learning how to use Solidity. This won&#8217;t be a comprehensive Solidity tutorial however, as Solidity is quite complex and rapidly evolving. We&#8217;ll cover the basics and give you enough of a foundation to be able to explore the rest on your own. The documentation for Solidity can be found at
<a href="https://solidity.readthedocs.io/en/latest/" class="bare">https://solidity.readthedocs.io/en/latest/</a></p>
</div>
<div class="sect3">
<h4 id="_data_types">Data types</h4>
<div class="paragraph">
<p>First, let&#8217;s look at some of the basic data types offered in Solidity:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">boolean (bool)</dt>
<dd>
<p>Boolean value, true or false, with logical operators ! (not), &amp;&amp; (and), || (or), == (equal), != (not equal).</p>
</dd>
<dt class="hdlist1">integer (int, uint)</dt>
<dd>
<p>Signed (int) and unsigned (uint) integers, declared in increments of 8 bits from int8 to uint256. Without a size suffix, 256-bit quantities are used, to match the word size of the EVM.</p>
</dd>
<dt class="hdlist1">fixed point (fixed, ufixed)</dt>
<dd>
<p>Fixed point numbers, declared with (u)fixedMxN where M is the size in bits (increments of 8 up to 256) and N is the number of decimals after the point (up to 18), e.g. ufixed32x2</p>
</dd>
<dt class="hdlist1">address</dt>
<dd>
<p>A 20-byte Ethereum address. The address object has many helpful member functions, the main ones being balance (returns the account balance) and transfer (transfer ether to the account).</p>
</dd>
<dt class="hdlist1">byte array (fixed)</dt>
<dd>
<p>Fixed-size arrays of bytes, declared with bytes1 up to bytes32.</p>
</dd>
<dt class="hdlist1">byte array (dynamic)</dt>
<dd>
<p>Variable-sized arrays of bytes, declared with bytes or string.</p>
</dd>
<dt class="hdlist1">enum</dt>
<dd>
<p>User-defined type for enumerating discrete values: enum NAME {LABEL1, LABEL 2, ...}.</p>
</dd>
<dt class="hdlist1">arrays</dt>
<dd>
<p>An array of any type, either fixed or dynamic: uint32[][5] is a fixed-size array of five dynamic arrays of unsigned integers</p>
</dd>
<dt class="hdlist1">struct</dt>
<dd>
<p>User-defined data containers for grouping variables: struct NAME {TYPE1 VARIABLE1; TYPE2 VARIABLE2; ...}.</p>
</dd>
<dt class="hdlist1">mapping</dt>
<dd>
<p>Hash lookup tables for key =&gt; value pairs: mapping(KEY_TYPE =&gt; VALUE_TYPE) NAME.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In addition to the data types above, Solidity also offers a variety of value literals that can be used to calculate different units:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">time units</dt>
<dd>
<p>The units seconds, minutes, hours, and days can be used as a suffix, converting to multiples of the base unit seconds.</p>
</dd>
<dt class="hdlist1">ether units</dt>
<dd>
<p>The units wei, finney, szabo, and ether can be used as a suffix, converting to multiples of the base unit wei.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>So far, in our Faucet contract example, we used uint (which is an alias for uint256), for the withdraw_amount variable. We also indirectly used an address variable, which we set with msg.sender. We will use more of these data types in our examples in the rest of this chapter.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s use one of the unit multipliers, to improve the readability of our example contract Faucet. In the withdraw function we limit the maximum withdrawal, expressing the amount limit as wei, the base unit of ether:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>require(withdraw_amount &lt;= 100000000000000000);</pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s not very easy to read, so we can improve our code by using the unit multiplier ether, to express the value in ether instead of wei:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>require(withdraw_amount &lt;= 0.1 ether);</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_predefined_global_variables_and_functions">Predefined global variables and functions</h4>
<div class="paragraph">
<p>When a contract is executed in the EVM, it has access to a small set of global objects. These include the block, msg and tx objects. In addition, Solidity exposes a number of EVM opcodes as predefined Solidity functions. In this section we will examine the variables and functions you can access from within a smart contract in Solidity.</p>
</div>
<div class="sect4">
<h5 id="_transactionmessage_call_context">Transaction/message call context</h5>
<div class="paragraph">
<p>The msg object is the transaction call (EOA originated) or message call (contract originated) that launched this contract execution. It contains a number of useful attributes:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">msg.sender</dt>
<dd>
<p>We&#8217;ve already used this one. It represents the address that initiated this contract call, not necessarily the originating EOA that sent the transaction. If our contract was called directly by an EOA transaction, then this is the address that signed the transaction, but otherwise it will be a contract address.</p>
</dd>
<dt class="hdlist1">msg.value</dt>
<dd>
<p>The value of ether sent with this call (in wei).</p>
</dd>
<dt class="hdlist1">msg.gas</dt>
<dd>
<p>The amount of gas left in the gas supply of this execution environment. It was deprecated in Solidity v0.4.21, and replaced by the gasleft() function.</p>
</dd>
<dt class="hdlist1">msg.data</dt>
<dd>
<p>The data payload of this call into our contract.</p>
</dd>
<dt class="hdlist1">msg.sig</dt>
<dd>
<p>The first four bytes of the data payload, which is the function selector.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Whenever a contract calls another contract, the values of all the attributes of msg change, to reflect the new caller&#8217;s information. The only exception to this is the delegatecall function, which runs the code of another contract/library within the original msg context.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_transaction_context">Transaction context</h5>
<div class="paragraph">
<p>The tx object provides a means of accessing transaction related information:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">tx.gasprice</dt>
<dd>
<p>The gas price in the calling transaction</p>
</dd>
<dt class="hdlist1">tx.origin</dt>
<dd>
<p>The address of the originating EOA for this transaction. WARNING: unsafe!</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_block_context">Block context</h5>
<div class="paragraph">
<p>The block object contains information about the current block:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">block.blockhash(blockNumber)</dt>
<dd>
<p>The block hash of the specified block number, up to 256 blocks in the past. Deprecated and replaced with the blockhash() function in Solidity v0.4.22.</p>
</dd>
<dt class="hdlist1">block.coinbase</dt>
<dd>
<p>The address of the recipient of the current block&#8217;s fees and block reward.</p>
</dd>
<dt class="hdlist1">block.difficulty</dt>
<dd>
<p>The difficulty (Proof-of-Work) of the current block.</p>
</dd>
<dt class="hdlist1">block.gaslimit</dt>
<dd>
<p>The maximum amount of gas that can be spent across all transactions included in the current block.</p>
</dd>
<dt class="hdlist1">block.number</dt>
<dd>
<p>The current block number (blockchain height).</p>
</dd>
<dt class="hdlist1">block.timestamp</dt>
<dd>
<p>The timestamp placed in the current block by the miner, the number of seconds since the Unix epoch.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="solidity_address_object">Address object</h5>
<div class="paragraph">
<p>Any address, either passed as an input, or cast from a contract object, has a number of attributes and methods:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">address.balance</dt>
<dd>
<p>The balance of the address, in wei. For example, the current contract balance is address(this).balance.</p>
</dd>
<dt class="hdlist1">address.transfer(amount)</dt>
<dd>
<p>Transfer the amount (wei) to this address, throwing an exception on any error. We used this function in our Faucet example as a method on the msg.sender address, as msg.sender.transfer().</p>
</dd>
<dt class="hdlist1">address.send(amount)</dt>
<dd>
<p>Similar to transfer above, only instead of throwing an exception, it returns false on error. WARNING: always check the return value of send().</p>
</dd>
<dt class="hdlist1">address.call(payload)</dt>
<dd>
<p>Low-level CALL function - can construct an arbitrary message call with a data payload. Returns false on error. WARNING: unsafe - recipient can (accidentally or maliciously) use up all your gas causing your contract to halt with an OOG exception; always check the return value of call().</p>
</dd>
<dt class="hdlist1">address.callcode(payload)</dt>
<dd>
<p>Low-level CALLCODE function - like address(this).call(...) but with this contract&#8217;s code replaced with that of address. Returns false on error. WARNING: advanced use only!</p>
</dd>
<dt class="hdlist1">address.delegatecall()</dt>
<dd>
<p>Low-level DELEGATECALL function - like callcode(...) but with the full msg context seen by the current contract. Returns false on error. WARNING: advanced use only!</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_built_in_functions">Built-in functions</h5>
<div class="paragraph">
<p>Other functions worth noting are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">addmod, mulmod</dt>
<dd>
<p>Modulo addition and multiplication. For example, addmod(x,y,k) calculates (x + y) % k.</p>
</dd>
<dt class="hdlist1">keccak256, sha256, sha3, ripemd160</dt>
<dd>
<p>Functions to calculate hashes with various standard hash algorithms.</p>
</dd>
<dt class="hdlist1">ecrecover</dt>
<dd>
<p>Recover the address used to sign a message from the signature.</p>
</dd>
<dt class="hdlist1">selfdestrunct(recipient_address)</dt>
<dd>
<p>delete the current contract, sending any remaining ether in the account to recipient_address.</p>
</dd>
<dt class="hdlist1">this</dt>
<dd>
<p>the address of the currently executing contract account.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_contract_definition">Contract definition</h4>
<div class="paragraph">
<p>Solidity&#8217;s principal data type is contract; our Faucet example simply defines a contract object. Similar to any object in an object-oriented language, the contract is a container that includes data and methods.</p>
</div>
<div class="paragraph">
<p>Solidity offers two other object types that are similar to a contract:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">interface</dt>
<dd>
<p>An interface definition is structured exactly like a contract, except none of the functions are defined, they are only declared. This type of declaration is often called a <em>stub</em>; it tells you the functions' arguments and return types without any implementation. An interface specifies the "shape" of a contract; when inherited, each of the functions declared by the interface must be defined by the child.</p>
</dd>
<dt class="hdlist1">library</dt>
<dd>
<p>A library contract is one that is meant to be deployed only once and used by other contracts, using the delegatecall method (see <a href="#solidity_address_object">Address object</a>).</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="solidity_functions">Functions</h4>
<div class="paragraph">
<p>Within a contract, we define functions that can be called by an EOA transaction or another contract. In our Faucet example, we have two functions: withdraw and the (unnamed) <em>fallback</em> function.</p>
</div>
<div class="paragraph">
<p><a href="#solidity_function_syntax">Solicity function declaration syntax</a> shows the syntax we use to declare a function in Solidity:</p>
</div>
<div id="solidity_function_syntax" class="imageblock">
<div class="content">
<img src="images/solidity_function_syntax.png" alt="Solicity function declaration syntax">
</div>
<div class="title">Figure 1. Solicity function declaration syntax</div>
</div>
<div class="paragraph">
<p>Let&#8217;s look at each of these components:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">FunctionName</dt>
<dd>
<p>The name of the function, which is used to call the function in a transaction (from an EOA), from another contract, or even from within the same contract. One function in each contract may be defined without a name, in which case it is the <em>fallback</em> function, which is called when no other function is named. The fallback function cannot have any arguments or return anything.</p>
</dd>
<dt class="hdlist1">parameters</dt>
<dd>
<p>Following the name, we specify the arguments that must be passed to the function, with their names and types. In our Faucet example we defined uint withdraw_amount as the only argument to the withdraw function.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The next set of keywords (public, private, internal, external) specify the function&#8217;s <em>visibility</em>:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">public</dt>
<dd>
<p>Public is the default; such functions can be called by other contracts, EOA transactions, or from within the contract. In our Faucet example, both functions are defined as public.</p>
</dd>
<dt class="hdlist1">external</dt>
<dd>
<p>External functions are like public, except they cannot be called from within the contract, unless explicitly prefixed with the keyword this.</p>
</dd>
<dt class="hdlist1">internal</dt>
<dd>
<p>Internal functions are only accessible from within the contract - they cannot be called by another contract or EOA transaction. They can be called by derived contracts (those that inherit this one).</p>
</dd>
<dt class="hdlist1">private</dt>
<dd>
<p>Private functions are like internal functions but cannot be called by derived contracts.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Keep in mind, the terms internal and private are somewhat misleading. Any function or data inside a contract is always <em>visible</em> on the public blockchain, meaning that anyone can see the code or data. The keywords above only affect how and when a function can be <em>called</em>.</p>
</div>
<div class="paragraph">
<p>The next set of keywords (pure, constant, view, payable) affect the behavior of the function:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">constant or view</dt>
<dd>
<p>A function marked as a <em>view</em> promises not to modify any state. The term <em>constant</em> is an alias for <em>view</em> that will be deprecated. At this time, the compiler does not enforce the <em>view</em> modifier, only producing a warning, but this is expected to become an enforced keyword in v0.5 of Solidity.</p>
</dd>
<dt class="hdlist1">pure</dt>
<dd>
<p>A pure function is one that neither reads nor writes any variables in storage. It can only operate on arguments and return data, without reference to any stored data. Pure functions are intended to encourage declarative-style programming without side-effects or state.</p>
</dd>
<dt class="hdlist1">payable</dt>
<dd>
<p>A payable function is one that can accept incoming payments. Functions without payable will reject incoming payments. There are two exceptions, due to design decisions in the EVM: coinbase payments and SELFDESTRUCT inheritance will be paid, even if the fallback function is not attributed as payable, but this makes sense because code execution is not part of those payments anyway.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>As you can see in our Faucet example, we have one payable function (the fallback function), which is the only function that can receive incoming payments.</p>
</div>
</div>
<div class="sect3">
<h4 id="_contract_constructor_and_selfdestruct">Contract constructor and selfdestruct</h4>
<div class="paragraph">
<p>There is a special function that is only used once. When a contract is created, it also runs the <em>constructor function</em> if one exists, to initialize the state of the contract. The constructor is run in the same transaction as the contract creation. The constructor function is optional, as you&#8217;ll notice our Faucet example has no constructor function.</p>
</div>
<div class="paragraph">
<p>Constructors can be specified in two ways. Up to and including Solidity v0.4.21, the constructor is a function whose name matches the name of the contract, as you&#8217;ll see in the example <a href="#old_constructor_style">Constructor function prior to Solidity v0.4.22</a>:</p>
</div>
<div id="old_constructor_style" class="listingblock">
<div class="title">Constructor function prior to Solidity v0.4.22</div>
<div class="content">
<pre>contract MEContract {
	function MEContract() {
		// This is the constructor
	}
}</pre>
</div>
</div>
<div class="paragraph">
<p>The difficulty with this format is that if the contract name is changed and the constructor function name is not changed, it is no longer a constructor. Likewise, if there is an accidental typo in the naming of the contract and/or constructor, the function is again no longer a constructor. This can cause some pretty nasty, unexpected and difficult-to-find bugs. Imagine for example if the constructor is setting the owner of the contract for purposes of control. If the function is not actually the constructor because of a naming error, not only will the owner be left unset at the time of contract creation, but the function may also be deployed as a permanent and "callable" part of the contract, like a normal function, allowing any third party to hijack the contract and become the "owner" after contract creation.</p>
</div>
<div class="paragraph">
<p>To address the potential problems with constructor functions being based on having an identical name as the contract, Solidity v0.4.22 introduces a constructor keyword that operates like a constructor function but does not have a name. Renaming the contract does not affect the constructor at all. Also, it is easier to identify which function is the constructor. It looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>pragma ^0.4.22
contract MEContract {
	constructor () {
		// This is the constructor
	}
}</pre>
</div>
</div>
<div class="paragraph">
<p>To summarize, a contract&#8217;s lifecycle starts with a creation transaction from an EOA or contract account. If there is a constructor, it is executed as part of contract creation, to initialize the state of the contract as it is being created, and is then discarded.</p>
</div>
<div class="paragraph">
<p>The other end of the contract&#8217;s lifecycle is <em>contract destruction</em>. Contracts are destroyed by a special EVM opcode called SELFDESTRUCT. It used to be called SUICIDE, but that name was deprecated due to the negative associations of the word. In Solidity, this opcode is exposed as a high level built-in function called selfdestruct, which takes one argument: the address to receive any ether balance remaining in the contract account. It looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>selfdestruct(address recipient);</pre>
</div>
</div>
<div class="paragraph">
<p>Note that you must explicitly add this command to your contract if you want it to be deletable - this is the only way a contract can be deleted, and it is not present by default. In this way, users of a contract who might rely on a contract being there forever, can be certain that a contract can&#8217;t be deleted if it doesn&#8217;t contain a SELFDESTRUCT opcode.</p>
</div>
</div>
<div class="sect3">
<h4 id="_adding_a_constructor_and_selfdestruct_to_our_faucet_example">Adding a constructor and selfdestruct to our Faucet example</h4>
<div class="paragraph">
<p>The Faucet example contract we introduced in <a href="#intro_chapter">[intro_chapter]</a> does not have any constructor or selfdestruct functions. It is an eternal contract that cannot be deleted. Let&#8217;s change that, by adding a constructor and selfdestruct function. We probably want the selfdestruct to be callable <em>only</em> by the EOA that originally created the contract. By convention, this is usually stored in an address variable called owner. Our constructor sets the owner variable, and the selfdestruct function will first check that the owner called it directly.</p>
</div>
<div class="paragraph">
<p>First our constructor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>// Version of Solidity compiler this program was written for
pragma solidity ^0.4.22;

// Our first contract is a faucet!
contract Faucet {

	address owner;

	// Initialize Faucet contract: set owner
	constructor() {
		owner = msg.sender;
	}

[...]</pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;ve changed the pragma directive to specify v0.4.22 as the minimum version for this example, as we are using the new constructor keyword introduced in v0.4.22 of Solidity. Our contract now has an address type variable named owner. The name "owner" is not special in any way. We could call this address variable "potato" and still use it the same way. The name owner simply makes its purpose clear.</p>
</div>
<div class="paragraph">
<p>Then, our constructor, which runs as part of the contract creation transaction, assigns the address from msg.sender to the owner variable. We used msg.sender in the withdraw function to identify the initiator of the withdrawal request. In the constructor however, the msg.sender is the EOA or contract address that initiated contract creation. We know this is the case <em>because</em> this is a constructor function: it only runs once, during contract creation.</p>
</div>
<div class="paragraph">
<p>Now we can add a function to destroy the contract. We need to make sure that only the owner can run this function, so we will use a require statement to control access. Here&#8217;s how it will look:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>// Contract destructor
function destroy() public {
	require(msg.sender == owner);
	selfdestruct(owner);
}</pre>
</div>
</div>
<div class="paragraph">
<p>If anyone other calls this destroy function from an address other than owner, it will fail. But if the same address stored in owner by the constructor calls it, the contract will self-destruct and send any remaining balance to the owner address. Note that we did not use the unsafe tx.origin to determine whether the owner wished to destroy the contract - using tx.orgin would allow malign contracts to destroy your contract without your permission.</p>
</div>
</div>
<div class="sect3">
<h4 id="_function_modifiers">Function modifiers</h4>
<div class="paragraph">
<p>Solidity offers a special type of function which is called a <em>function modifier</em>. You apply modifiers to functions by adding the modifier name in the function declaration. Modifier functions are most often used to create conditions that apply to many functions within a contract. We have an access control statement already, in our destroy function. Let&#8217;s create a function modifier that expresses that condition:</p>
</div>
<div id="function_modifier_onlyowner" class="listingblock">
<div class="title">onlyOwner function modifier</div>
<div class="content">
<pre>modifier onlyOwner {
    require(msg.sender == owner);
    _;
}</pre>
</div>
</div>
<div class="paragraph">
<p>In <a href="#function_modifier_onlyowner">onlyOwner function modifier</a> we see the declaration of a function modifier, named onlyOwner. This function modifier sets a condition on any function that it modifies, requiring that the address stored as the owner of the contract is the same as the address of the transaction&#8217;s msg.sender. This is the basic design pattern for access control, allowing only the owner of a contract to execute any function that has the onlyOwner modifier.</p>
</div>
<div class="paragraph">
<p>You may have noticed that our function modifier has a peculiar syntactic "placeholder" in it, an underscore followed by a semicolon (&#95;;). This placeholder is replaced by the code of the function that is being modified. Essentially, the modifier is "wrapped around" the modified function, placing its code in the location identified by the underscore character.</p>
</div>
<div class="paragraph">
<p>To apply a modifier, you add its name to the function declaration. More than one modifier can be applied to a function, as a comma-separated list, applied in the sequence they are declared.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s rewrite our destroy function to use the onlyOwner modifier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>function destroy() public onlyOwner {
    selfdestruct(owner);
}</pre>
</div>
</div>
<div class="paragraph">
<p>The function modifier&#8217;s name (onlyOwner) is after the keyword public and tells us that the destroy function is modified by the onlyOwner modifier. Essentially you can read this as "Only the owner can destroy this contract". In practice, the resulting code is equivalent to "wrapping" the code from onlyOwner around destroy.</p>
</div>
<div class="paragraph">
<p>Function modifiers are an extremely useful tool because they allow us to write preconditions for functions and apply them consistently, making the code easier to read and, as a result, easier to audit for security. They are most often used for access control, however, they are quite versatile and can be used for a variety of other purposes.</p>
</div>
<div class="paragraph">
<p>Inside a modifier, you can access all the values (variables and arguments) visible to the modified function. In this case, we can access the owner variable, which is declared within the contract. However, the inverse is not true: you cannot access any of the modifier&#8217;s variables inside the modified function.</p>
</div>
</div>
<div class="sect3">
<h4 id="_contract_inheritance">Contract inheritance</h4>
<div class="paragraph">
<p>Solidity&#8217;s contract object supports <em>inheritance</em>, which is a mechanism for extending a base contract with additional functionality. To use inheritance, specify a parent contract with the keyword is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>contract Child is Parent {
  ...
}</pre>
</div>
</div>
<div class="paragraph">
<p>With this construct, the Child contract inherits all the methods, functionality, and variables of Parent. Solidity also supports multiple inheritance, which can be specified by comma-separated contract names after the keyword is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>contract Child is Parent1, Parent2 {
  ...
}</pre>
</div>
</div>
<div class="paragraph">
<p>Contract inheritance allows us to write our contracts in such a way as to achieve modularity, extensibility and reuse. We start with contracts that are simple and implement the most generic capabilities, then extend them by inheriting those capabilities in more specialized contracts.</p>
</div>
<div class="paragraph">
<p>In our Faucet contract, we introduced the constructor and destructor, together with access control for an owner, assigned on construction. Those capabilities are quite generic: many contracts will have them. We can define them as generic contracts, then use inheritance to extend them to the Faucet contract.</p>
</div>
<div class="paragraph">
<p>We start by defining a base contract owned, which has an owner variable, setting it in the contract&#8217;s constructor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>contract owned {
	address owner;

	// Contract constructor: set owner
	constructor() {
		owner = msg.sender;
	}

	// Access control modifier
	modifier onlyOwner {
	    require(msg.sender == owner);
	    _;
	}
}</pre>
</div>
</div>
<div class="paragraph">
<p>Next, we define a base contract mortal, which inherits owned:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>contract mortal is owned {
	// Contract destructor
	function destroy() public onlyOwner {
		selfdestruct(owner);
	}
}</pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the mortal contract can use the onlyOwner function modifier, defined in owned. It indirectly also uses the owner address variable and the constructor defined in owned. Inheritance makes each contract simpler and focused on its specific functionality, allowing us to manage the details in a modular way.</p>
</div>
<div class="paragraph">
<p>Now we can further extend the owned contract, inheriting its capabilities in Faucet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>contract Faucet is mortal {
    // Give out ether to anyone who asks
    function withdraw(uint withdraw_amount) public {
        // Limit withdrawal amount
        require(withdraw_amount &lt;= 0.1 ether);
        // Send the amount to the address that requested it
        msg.sender.transfer(withdraw_amount);
    }
    // Accept any incoming amount
    function () public payable {}
}</pre>
</div>
</div>
<div class="paragraph">
<p>By inheriting mortal, which in turn inherits owned, the Faucet contract now has the constructor and destroy functions, and a defined owner. The functionality is the same as when those functions were within Faucet, but now we can reuse those functions in other contracts without writing them again. Code reuse and modularity make our code cleaner, easier to read, and easier to audit.</p>
</div>
</div>
<div class="sect3">
<h4 id="_error_handling_assert_require_revert">Error handling (assert, require, revert)</h4>
<div class="paragraph">
<p>A contract call can terminate and return an error. Error handling in Solidity is handled by four functions: assert, require, revert, and throw (now deprecated).</p>
</div>
<div class="paragraph">
<p>When a contract terminates with an error, all the state changes (changes to variables, balances, etc.) are reverted, all the way up the chain of contract calls if more than one contract was called. This ensures that transactions are atomic, meaning they either complete successfully or have no effect on state and are reverted entirely.</p>
</div>
<div class="paragraph">
<p>The assert and require functions operate in the same way, evaluating a condition and stopping execution with an error if the condition is false. By convention, assert is used when the outcome is expected to be true, meaning that we use assert to test internal conditions. By comparison, require is used when testing inputs (such as function arguments or transaction fields), setting our expectations for those conditions.</p>
</div>
<div class="paragraph">
<p>We&#8217;ve used require in our function modifier onlyOwner, to test that the message sender is the owner of the contract:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>require(msg.sender == owner);</pre>
</div>
</div>
<div class="paragraph">
<p>The require function acts as a <em>gate condition</em>, preventing execution of the rest of the function and producing an error if it is not satisfied.</p>
</div>
<div class="paragraph">
<p>As of Solidity v0.4.22, require can also include a helpful text message that can be used to show the reason for the error. The error message is recorded in the transaction log. So we can improve our code, by adding an error message in our require function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>require(msg.sender == owner, "Only the contract owner can call this function");</pre>
</div>
</div>
<div class="paragraph">
<p>The revert and throw functions halt the execution of the contract and revert any state changes. The throw function is obsolete and will be removed in future versions of Solidity - you should use revert instead. The revert function can also take an error message as the only argument, which is recorded in the transaction log.</p>
</div>
<div class="paragraph">
<p>Certain conditions in a contract will generate errors regardless of whether we explicitly check for them. For example, in our Faucet contract, we don&#8217;t check whether there is enough ether to satisfy a withdrawal request. That&#8217;s because the transfer function will fail with an error and revert the transaction if there is insufficient balance to make the transfer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>msg.sender.transfer(withdraw_amount);</pre>
</div>
</div>
<div class="paragraph">
<p>However, it might be better to check explicitly and provide a clear error message on failure. We can do that by adding a require statement before the transfer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>require(this.balance &gt;= withdraw_amount,
	"Insufficient balance in faucet for withdrawal request");
msg.sender.transfer(withdraw_amount);</pre>
</div>
</div>
<div class="paragraph">
<p>Additional error checking code like this will increase gas consumption slightly, but it offers better error reporting than if omitted. You will need to find the right balance between gas consumption and verbose error checking based on the expected use of your contract. In the case of a Faucet intended for a testnet, we&#8217;d probably err on the side of extra reporting even if it costs more gas. Perhaps for a mainnet contract we&#8217;d choose to be frugal with our gas usage instead.</p>
</div>
</div>
<div class="sect3">
<h4 id="solidity_events">Events</h4>
<div class="paragraph">
<p>Events are Solidity constructs that facilitate the production of transaction logs. When a transaction completes (successfully or not), it produces a <em>transaction receipt</em>, as we will see in <a href="#evm_chapter">[evm_chapter]</a>. The transaction receipt contains <em>log</em> entries that provide information about the actions that occurred during the execution of the transaction. Events are the Solidity high-level objects that are used to construct these logs.</p>
</div>
<div class="paragraph">
<p>Events are especially useful for light clients and DApp services, which can "watch" for specific events and report them to the user-interface, or make a change in the state of the application to reflect an event in an underlying contract.</p>
</div>
<div class="paragraph">
<p>Event objects take arguments that are serialized and recorded in the transaction logs, in the blockchain. You can supply the keyword indexed before an argument, to make the value part of an indexed table (hash table) that can be searched or filtered by an application.</p>
</div>
<div class="paragraph">
<p>We have not added any events in our Faucet example, so far, so let&#8217;s do that. We will add two events, one to log any withdrawals and one to log any deposits. We will call these events Withdrawal and Deposit respectively. First, we define the events in the Faucet contract:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>contract Faucet is mortal {
	event Withdrawal(address indexed to, uint amount);
	event Deposit(address indexed from, uint amount);

	[...]
}</pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;ve chosen to make the addresses indexed, to allow searching and filtering in any user interface built to access our Faucet.</p>
</div>
<div class="paragraph">
<p>Next, we use the emit keyword to incorporate the event data in the transaction logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>// Give out ether to anyone who asks
function withdraw(uint withdraw_amount) public {
    [...]
    msg.sender.transfer(withdraw_amount);
    emit Withdrawal(msg.sender, withdraw_amount);
}
// Accept any incoming amount
function () public payable {
    emit Deposit(msg.sender, msg.value);
}</pre>
</div>
</div>
<div class="paragraph">
<p>The resulting Faucet.sol contract looks like this example: <a href="#Faucet8_sol">Faucet8.sol: Revised Faucet contract, with events</a>.</p>
</div>
<div id="Faucet8_sol" class="listingblock">
<div class="title">Faucet8.sol: Revised Faucet contract, with events</div>
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">// Version of Solidity compiler this program was written for
pragma solidity ^0.4.22;

contract owned {
	address owner;
	// Contract constructor: set owner
	constructor() {
		owner = msg.sender;
	}
	// Access control modifier
	modifier onlyOwner {
		require(msg.sender == owner, "Only the contract owner can call this function");
		_;
	}
}

contract mortal is owned {
	// Contract destructor
	function destroy() public onlyOwner {
		selfdestruct(owner);
	}
}

contract Faucet is mortal {
	event Withdrawal(address indexed to, uint amount);
	event Deposit(address indexed from, uint amount);

	// Give out ether to anyone who asks
	function withdraw(uint withdraw_amount) public {
		// Limit withdrawal amount
		require(withdraw_amount &lt;= 0.1 ether);
		require(this.balance &gt;= withdraw_amount,
			"Insufficient balance in faucet for withdrawal request");
		// Send the amount to the address that requested it
		msg.sender.transfer(withdraw_amount);
		emit Withdrawal(msg.sender, withdraw_amount);
	}
	// Accept any incoming amount
	function () public payable {
		emit Deposit(msg.sender, msg.value);
	}
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_catching_events">Catching Events</h5>
<div class="paragraph">
<p>OK, so we&#8217;ve set up our contract to emit events. How do we see the results of a transaction and "catch" the events? The web3.js library provides a data structure that contains a transaction&#8217;s logs. Within those we can see the events generated by the transaction.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s use truffle to run a test transaction on the revised Faucet contract. Follow the instructions in <a href="#truffle">[truffle]</a> to set up a project directory and compile the Faucet code. The source code can be found in the book&#8217;s GitHub repository under code/truffle/FaucetEvents.</p>
</div>
<div id="testing_events_prep" class="listingblock">
<div class="content">
<pre>$ truffle develop
truffle(develop)&gt; compile
truffle(develop)&gt; migrate
Using network 'develop'.

Running migration: 1_initial_migration.js
  Deploying Migrations...
  ... 0xb77ceae7c3f5afb7fbe3a6c5974d352aa844f53f955ee7d707ef6f3f8e6b4e61
  Migrations: 0x8cdaf0cd259887258bc13a92c0a6da92698644c0
Saving successful migration to network...
  ... 0xd7bc86d31bee32fa3988f1c1eabce403a1b5d570340a3a9cdba53a472ee8c956
Saving artifacts...
Running migration: 2_deploy_contracts.js
  Deploying Faucet...
  ... 0xfa850d754314c3fb83f43ca1fa6ee20bc9652d891c00a2f63fd43ab5bfb0d781
  Faucet: 0x345ca3e014aaf5dca488057592ee47305d9b3e10
Saving successful migration to network...
  ... 0xf36163615f41ef7ed8f4a8f192149a0bf633fe1a2398ce001bf44c43dc7bdda0
Saving artifacts...

truffle(develop)&gt; Faucet.deployed().then(i =&gt; {FaucetDeployed = i})
truffle(develop)&gt; FaucetDeployed.send(web3.toWei(1, "ether")).then(res =&gt; { console.log(res.logs[0].event, res.logs[0].args) })
Deposit { from: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  amount: BigNumber { s: 1, e: 18, c: [ 10000 ] } }
truffle(develop)&gt; FaucetDeployed.withdraw(web3.toWei(0.1, "ether")).then(res =&gt; { console.log(res.logs[0].event, res.logs[0].args) })
Withdrawal { to: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  amount: BigNumber { s: 1, e: 17, c: [ 1000 ] } }</pre>
</div>
</div>
<div class="paragraph">
<p>After deploying the contract using the deployed() function, we execute two transactions. The first transaction is a deposit (using send), which emits a Deposit event in the transaction logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Deposit { from: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  amount: BigNumber { s: 1, e: 18, c: [ 10000 ] } }</pre>
</div>
</div>
<div class="paragraph">
<p>Next, we use the withdraw function to make a withdrawal. This emits a Withdrawal event:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Withdrawal { to: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  amount: BigNumber { s: 1, e: 17, c: [ 1000 ] } }</pre>
</div>
</div>
<div class="paragraph">
<p>To get these events, we looked at the logs array returned as a result (res) of the transactions. The first log entry (logs[0]) contains an event name in logs[0].event and the event arguments in logs[0].args. By showing these on the console, we can see the emitted event name and the event arguments.</p>
</div>
<div class="paragraph">
<p>Events are a very useful mechanism, not only for intra-contract communication, but also for debugging during development.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_calling_other_contracts_send_call_callcode_delegatecall">Calling other contracts (send, call, callcode, delegatecall)</h4>
<div class="paragraph">
<p>Calling other contracts from within your contract is a very useful but potentially dangerous operation. We&#8217;ll examine the various ways you can achieve this and evaluate the risks of each method. In short, the risks arise from the fact that you may have no idea about a contract you are calling into or which is calling into your contract. When writing smart contracts, you must keep in mind that, while you may mostly expect to be dealing with EOAs, there is nothing to stop arbitrarily complex and perhaps malign contracts from calling into and being called by your code.</p>
</div>
<div class="sect4">
<h5 id="_creating_a_new_instance">Creating a new instance</h5>
<div class="paragraph">
<p>The safest way to call another contract is if you create that other contract yourself. That way, you are certain of its interfaces and behavior. To do this, you can simply instantiate it, using the keyword new, as in other object-oriented languages. In Solidity, the keyword new will create the contract on the blockchain and return an object that you can use to reference it. Let&#8217;s say you want to create and call a Faucet contract from within another contract called Token:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>contract Token is mortal {
	Faucet _faucet;

	constructor() {
		_faucet = new Faucet();
	}
}</pre>
</div>
</div>
<div class="paragraph">
<p>This mechanism for contract construction ensures that you know the exact type of contract and its interface. The contract Faucet must be defined within the scope of Token, which you can do with an import statement if the definition is in another file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>import "Faucet.sol";

contract Token is mortal {
	Faucet _faucet;

	constructor() {
		_faucet = new Faucet();
	}
}</pre>
</div>
</div>
<div class="paragraph">
<p>We can optionally specify the value of ether transfer on creation, and pass arguments to the new contract&#8217;s constructor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>import "Faucet.sol";

contract Token is mortal {
	Faucet _faucet;

	constructor() {
		_faucet = (new Faucet).value(0.5 ether)();
	}
}</pre>
</div>
</div>
<div class="paragraph">
<p>We can also then call the Faucet functions. In this example, we call the destroy function of Faucet, from within the destroy function of Token:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>import "Faucet.sol";

contract Token is mortal {
	Faucet _faucet;

	constructor() {
		_faucet = (new Faucet).value(0.5 ether)();
	}

	function destroy() ownerOnly {
		_faucet.destroy();
	}
}</pre>
</div>
</div>
<div class="paragraph">
<p>Note that, while you are the owner of the Token contract, the Token contract itself owns the new Faucet contract, so only the Token contract can destroy it.</p>
</div>
</div>
<div class="sect4">
<h5 id="_addressing_an_existing_instance">Addressing an existing instance</h5>
<div class="paragraph">
<p>Another way we can call a contract is to cast the address of an existing instance of the contract. With this method, we apply a known interface to an existing instance. It is therefore critically important that we know, for sure, that the instance we are addressing is in fact of the type we assume. Let&#8217;s look at an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>import "Faucet.sol";

contract Token is mortal {

	Faucet _faucet;

	constructor(address _f) {
		_faucet = Faucet(_f);
		_faucet.withdraw(0.1 ether)
	}
}</pre>
</div>
</div>
<div class="paragraph">
<p>Here, we take an address provided as an argument to the constructor, _f, and we cast it to a Faucet object. This is much riskier than the previous mechanism, because we don&#8217;t know for sure whether that address actually is a Faucet object. When we call withdraw, we are assuming that it accepts the same arguments and executes the same code as our Faucet declaration, but we can&#8217;t be sure. For all we know, the withdraw function at this address could execute something completely different from what we expect, even if it is named the same. Using addresses passed as input and casting them into specific objects is therefore much more dangerous than creating the contract ourselves.</p>
</div>
</div>
<div class="sect4">
<h5 id="_raw_call_delegatecall">Raw call, delegatecall</h5>
<div class="paragraph">
<p>Solidity offers some even more "low-level" functions for calling other contracts. These correspond directly to EVM opcodes of the same name and allow us to construct a contract-to-contract call manually. As such, they represent the most flexible <em>and</em> the most dangerous mechanisms for calling other contracts.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s the same example, using a call method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>contract Token is mortal {
	constructor(address _faucet) {
		_faucet.call("withdraw", 0.1 ether);
	}
}</pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, this type of call, is a <em>blind</em> call into a function, very much like constructing a raw transaction, only from within a contract&#8217;s context. It can expose our contract to a number of security risks, most importantly <em>re-entrancy</em>, which we will discuss in more detail in <a href="#reentrancy_security">[reentrancy_security]</a>. The call function will return false if there is a problem, so we can evaluate the return value, for error handling:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>contract Token is mortal {
	constructor(address _faucet) {
		if !(_faucet.call("withdraw", 0.1 ether)) {
			revert("Withdrawal from faucet failed");
		}
	}
}</pre>
</div>
</div>
<div class="paragraph">
<p>Another variant of call is delegatecall, which replaced the more dangerous callcode. The callcode method will be deprecated soon, so it should not be used.</p>
</div>
<div class="paragraph">
<p>As mentioned in <a href="#solidity_address_object">Address object</a>, a delegatecall is different from a call, in that the msg context does not change. For example, whereas a call changes the value of msg.sender to be the calling contract, a delegatecall keeps the same msg.sender as it is in the calling contract. Essentially, delegatecall runs the code of another contract inside the context of the execution of the current contract. It is most often used to invoke code from a library. It also allows you to draw on the pattern of using library functions stored elsewhere, but have that code work with the storage data of your contract.</p>
</div>
<div class="paragraph">
<p>The delegate call should be used with great caution. It can have some unexpected effects, especially if the contract you call was not designed as a library.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s use an example contract to demonstrate the various call semantics used by call and delegatecall for calling libraries and contracts. We use an event to log the details of each call and see how the calling context changes depending on the call type:</p>
</div>
<div id="call_examples_code" class="listingblock">
<div class="title">CallExamples.sol: An example of different call semantics.</div>
<div class="content">
<pre class="highlight"><code class="language-solidity" data-lang="solidity">pragma solidity ^0.4.22;

contract calledContract {
	event callEvent(address sender, address origin, address from);
	function calledFunction() public {
		emit callEvent(msg.sender, tx.origin, this);
	}
}

library calledLibrary {
	event callEvent(address sender, address origin,  address from);
	function calledFunction() public {
		emit callEvent(msg.sender, tx.origin, this);
	}
}

contract caller {

	function make_calls(calledContract _calledContract) public {

		// Calling the calledContract and calledLibrary directly
		_calledContract.calledFunction();
		calledLibrary.calledFunction();

		// Low level calls using the address object for calledContract
		require(address(_calledContract).call(bytes4(keccak256("calledFunction()"))));
		require(address(_calledContract).delegatecall(bytes4(keccak256("calledFunction()"))));



	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see in <a href="#call_examples_code">CallExamples.sol: An example of different call semantics.</a>, our main contract is caller, which calls a library calledLibrary and a contract calledContract. Both the called library and contract have identical functions calledFunction, which emit an event calledEvent. The event calledEvent logs three pieces of data: msg.sender, tx.origin, and this. Each time calledFunction is called it may have a different execution context (with different values for the potentially all the context variables), depending on whether it is called directly or through delegatecall.</p>
</div>
<div class="paragraph">
<p>In caller, we first call the contract and library directly, by invoking the calledFunction in each. Then, we explicitly use the low-level functions call and delegatecall to call the calledContract.calledFunction. This way we can see how the various calling mechanisms behave.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s run this in a truffle development environment and capture the events, to see how it looks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>truffle(develop)&gt; migrate
Using network 'develop'.
[...]
Saving artifacts...
truffle(develop)&gt; web3.eth.accounts[0]
'0x627306090abab3a6e1400e9345bc60c78a8bef57'
truffle(develop)&gt; caller.address
'0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f'
truffle(develop)&gt; calledContract.address
'0x345ca3e014aaf5dca488057592ee47305d9b3e10'
truffle(develop)&gt; calledLibrary.address
'0xf25186b5081ff5ce73482ad761db0eb0d25abfbf'
truffle(develop)&gt; caller.deployed().then( i =&gt; { callerDeployed = i })

truffle(develop)&gt; callerDeployed.make_calls(calledContract.address).then(res =&gt; { res.logs.forEach( log =&gt; { console.log(log.args) })})
{ sender: '0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f',
  origin: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  from: '0x345ca3e014aaf5dca488057592ee47305d9b3e10' }
{ sender: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  origin: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  from: '0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f' }
{ sender: '0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f',
  origin: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  from: '0x345ca3e014aaf5dca488057592ee47305d9b3e10' }
{ sender: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  origin: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
  from: '0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f' }</pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s see what happened here. We called the make_calls function and passed the address of calledContract, then caught the four events emitted by each of the different calls. Look at the make_calls function and let&#8217;s walk through each step.</p>
</div>
<div class="paragraph">
<p>The first call is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>_calledContract.calledFunction();</pre>
</div>
</div>
<div class="paragraph">
<p>Here, we&#8217;re calling the calledContract.calledFunction directly, using the high-level ABI for calledFunction. The event emitted is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sender: '0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f',
origin: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
from: '0x345ca3e014aaf5dca488057592ee47305d9b3e10'</pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, msg.sender is the address of the caller contract. The tx.origin is the address of our account web3.eth.accounts[0] that sent the transaction to caller. The event was emitted by calledContract, as we can see from the last argument in the event.</p>
</div>
<div class="paragraph">
<p>The next call in make_calls, is to the library:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>calledLibrary.calledFunction();</pre>
</div>
</div>
<div class="paragraph">
<p>It looks identical to how we called the contract, but behaves <strong>very</strong> differently. Let&#8217;s look at the second event emitted:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sender: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
origin: '0x627306090abab3a6e1400e9345bc60c78a8bef57',
from: '0x8f0483125fcb9aaaefa9209d8e9d7b9c8b9fb90f'</pre>
</div>
</div>
<div class="paragraph">
<p>This time, the msg.sender is not the address of caller. Instead it is the address of our account, and is the same as the transaction origin. That&#8217;s because when you call a library, the call is always delegatecall and runs within the context of the caller. So, when calledLibrary code was running, it inherited the execution context of caller, as if its code was running inside caller. The variable this (shown as from in the event emitted) is the address of caller, even though it is accessed from within calledLibrary.</p>
</div>
<div class="paragraph">
<p>The next two calls, using the low-level call and delegatecall, verify our expectations, emitting events that mirror what we just saw above.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="gas_sec">Gas considerations</h3>
<div class="paragraph">
<p>Gas is described in more in detail in <a href="#gas">[gas]</a>, and is an incredibly important consideration in smart contract programming. Gas is a resource constraining the maximum amount of computation that Ethereum will allow a transaction to consume. If the gas limit is exceeded during computation, the following series of events occurs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An "out of gas" exception is thrown.</p>
</li>
<li>
<p>The state of the contract prior to execution is restored (reverted).</p>
</li>
<li>
<p>All ether used to pay for the gas is taken as a transaction fee; it is <em>not</em> refunded.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Because gas is paid by the user who initiates the transaction, users are discouraged from calling functions that have a high gas cost. It is thus in the programmer&#8217;s best interest to minimize the gas cost of a contract&#8217;s functions. To this end, there are certain practices that are recommended when constructing smart contracts, so as to minimize the gas cost of a function call.</p>
</div>
<div class="sect3">
<h4 id="_avoid_dynamically_sized_arrays">Avoid dynamically-sized arrays</h4>
<div class="paragraph">
<p>Any loop through a dynamically sized array where a function performs operations on each element or searches for a particular element introduces the risk of using too much gas. Indeed, the contract may run out of gas before finding the desired result, or before acting on every element, thus wasting time and ether without giving any result at all.</p>
</div>
</div>
<div class="sect3">
<h4 id="_avoid_calls_to_other_contracts">Avoid calls to other contracts</h4>
<div class="paragraph">
<p>Calling other contracts, especially when the gas cost of their functions is not known, introduces the risk of running out of gas. Avoid using libraries that are not well tested and broadly used. The less scrutiny a library has received from other programmers, the greater the risk of using it.</p>
</div>
</div>
<div class="sect3">
<h4 id="_estimating_gas_cost">Estimating gas cost</h4>
<div class="paragraph">
<p>If you need to estimate the gas necessary to execute a certain method of a contract considering its arguments, you could use the following procedure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-JavaScript" data-lang="JavaScript">var contract = web3.eth.contract(abi).at(address);
var gasEstimate = contract.myAweSomeMethod.estimateGas(arg1, arg2, {from: account});</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>gasEstimate</strong> will tell us the number of gas units needed for its execution. It is an estimate because of the Turing completeness of the EVM - it is relatively trivial to create a function that will take vastly different amounts of gas to execute different calls. Even production code can change execution paths in subtle ways, resulting in hugely different gas costs from one call to the call. However, most functions are sensible and estimateGas will give a good estimate most of the time.</p>
</div>
<div class="paragraph">
<p>To obtain the <strong>gas price</strong> from the network you can use;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-JavaScript" data-lang="JavaScript">var gasPrice = web3.eth.getGasPrice();</code></pre>
</div>
</div>
<div class="paragraph">
<p>And from there, estimate the <strong>gas cost</strong>;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-JavaScript" data-lang="JavaScript">var gasCostInEther = web3.fromWei((gasEstimate * gasPrice), 'ether');</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s apply our gas estimation functions to estimating the gas cost of our Faucet example, using the code from the book&#8217;s repository found here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>code/truffle/FaucetEvents</pre>
</div>
</div>
<div class="paragraph">
<p>We start truffle in development mode, and execute a JavaScript file <a href="#estimateGas_function">gas_estimates.js: Using the estimateGas function</a>, which contains:</p>
</div>
<div id="estimateGas_function" class="listingblock">
<div class="title">gas_estimates.js: Using the estimateGas function</div>
<div class="content">
<pre class="highlight"><code class="language-JavaScript" data-lang="JavaScript">var FaucetContract = artifacts.require("./Faucet.sol");

FaucetContract.web3.eth.getGasPrice(function(error, result) {
    var gasPrice = Number(result);
    console.log("Gas Price is " + gasPrice + " wei"); // "10000000000000"

    // Get the contract instance
    FaucetContract.deployed().then(function(FaucetContractInstance) {

        // Use the keyword 'estimateGas' after the function name to get the gas estimation for this particular function (aprove)
		FaucetContractInstance.send(web3.toWei(1, "ether"));
        return FaucetContractInstance.withdraw.estimateGas(web3.toWei(0.1, "ether"));

    }).then(function(result) {
        var gas = Number(result);

        console.log("gas estimation = " + gas + " units");
        console.log("gas cost estimation = " + (gas * gasPrice) + " wei");
        console.log("gas cost estimation = " + FaucetContract.web3.fromWei((gas * gasPrice), 'ether') + " ether");
    });
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here&#8217;s how that looks in the truffle development console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ truffle develop

truffle(develop)&gt; exec gas_estimates.js
Using network 'develop'.

Gas Price is 20000000000 wei
gas estimation = 31397 units
gas cost estimation = 627940000000000 wei
gas cost estimation = 0.00062794 ether</pre>
</div>
</div>
<div class="paragraph">
<p>It is recommended that you evaluate the gas cost of functions as part of your development workflow, to avoid any surprises when deploying contracts to the mainnet.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conclusions">Conclusions</h3>
<div class="paragraph">
<p>In this chapter we started working with smart contracts in detail and epxlored the Solidity contract programming language. We took a simple example contract Faucet.sol and gradually improved it and made it more complex, using it to explore various aspects of the Solidity language. Next, in <a href="#vyper_chap">[vyper_chap]</a> we will work with Vyper, another contract oriented programming language. We will compare Vyper to Solidity, showing some of the differences in the design of these two languages and deepening our understanding of smart contract programming.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-10-10 09:01:38 EDT
</div>
</div>
</body>
</html>